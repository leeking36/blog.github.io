---
layout: post
title: 包管理工具
anchor: blog05
---

## （一）npm

Node 包管理器(Node Package Manager)，但是目前已经不仅仅是 Node 包管理器了，在前端项目中我们也在使用它来管理依赖的包：比如 vue、vue-router、vuex、express、koa、react、react-dom、axios、babel、webpack 等等。

### 下载和安装 npm

npm 属于 node 的一个管理工具，安装 Node 的过程会自动安装 npm 工具，推荐使用 nvm，详情请看[NodeJs 版本管理](https://leeking36.github.io/blog03/)

### 依赖包的查看和搜索

登录[官网](https://www.npmjs.org/)
我们发布自己的包其实是发布到 registry 上面的，当我们安装一个包时其实是从 registry 上面下载的包。

### 配置文件 package.json

每一个项目都会有一个对应的配置文件，无论是前端项目（Vue、React）还是后端项目（Node），这个配置文件会记录着你项目的名称、版本号、项目描述等，也会记录着你项目所依赖的其他库的信息和依赖库的版本号。

1. 手动从零创建项目，`npm init –y`
2. 通过脚手架创建项目，脚手架会帮助我们生成 package.json，并且里面有相关的配置

### 如何发布 npm 包

#### 注册 NPM 账号

记下自己的用户名、密码、和邮箱。

#### 新建一个文件夹

新建一个文件夹，命名没有要求。

#### 配置包的参数

进入到目标文件夹，我们终端输入以下命令：

```json
npm init
```

然后会让我们输入一些配置项，来看看都有哪些内容：

<img src="https://leeking36.github.io/images/package.json.png" width="50%">

全部输入完以后，会给我们一个预览，问我们这样可以吗，然后回车，之后会在根目录下生成一个 package.json 的文件。

##### name 参数配置

1. name 是唯一的，不能和 npm 上所有已有的包重名，否则在 `npm publish` 的时候回会提示权限错误。
2. 命名规范：不能出现下划线、大写字母、空格等字符，可以有连字符（中划线）。
3. 先创建 `index.js` 文件，作为测试，在里面写几行简单代码，并 `export` 一个默认变量。

#### 生成 package-lock.json

执行下方命令，生成 package-lock.json 文件，方便我们查看和调试。

```json
npm link
```

#### 登录账号

```javascript
npm login
//回车 然后输入Username Password Email 即可
```

1. 如果用淘宝源的时候报了 500 错误，改成 npm 的源就好了。
2. 如果出现 Enter one-time password，把邮箱收到的验证码输入在命令行里就行了。

当看到 Logged in as hanzhiwei0174 on https://registry.npmjs.org/.就说明我们登录成功了。

#### 发布代码

```javascript
npm publish
```

当我们看到 +xxx 就证明我们已经发布成功了，可以在 npm 的官网查看。

### 如何使用发布的 npm 包

#### 在项目里下载依赖包

```javascript
npm i xxx -s
```

然后在 node_modules 找一下，打开 index.js 发现和我们之前写的一模一样。

### 如何更新包版本

代码修改完成后，修改 package.json 中的 version 字段，然后再次执行 npm publish 即可。

### 如何删除包版本

```javascript
npm unpublish package.name@version
```

当我们看到 -xxx 的时候，说明版本已经成功的删除掉了，可以看到版本回退了。

### 撤销发布 npm 包

```javascript
npm unpublish xxx
```

1. 不允许撤销发布已经超过 24 小时的包（unpublish is only allowed with versions published in the last 24 hours）。
2. 如果在 24 小时内确实要撤销，需要加--force 参数。
3. 即使撤销了发布的包，再次发布的时候也不能与之前被撤销的包的名称/版本其中之一相同，因为这两者构成的唯一性已经被占用，官方并没有随着撤销而删除。
